---
description: >-
  Cascade HTB Machine
title: Cascade (Medium)                # Add title here
date: 2023-04-24 08:00:00 -0600                           # Change the date to match completion date
categories: [HackTheBox, Windows - Medium]                     # Change Templates to Writeup
tags: []     # TAG names should always be lowercase; replace template with writeup, and add relevant tags
show_image_post: true                                    # Change this to true
image: /assets/img/icons/Cascade.png                # Add infocard image here for post preview image
---
### Host entries:
```bash
10.10.10.182  cascade.local
```
If Active Directory => [NTP Synchronization](https://shuciran.github.io/posts/NTP-Synchronization/) with the domain controller.

### Content

- 
- 

### Reconnaissance

Initial reconnaissance for TCP ports
```bash
nmap -p- -sS --open --min-rate 5000 -Pn -n -vvv -oG allPorts 10.10.10.182
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.10.182 ()   Status: Up
Host: 10.10.10.182 ()   Ports: 53/open/tcp//domain///, 88/open/tcp//kerberos-sec///, 135/open/tcp//msrpc///, 139/open/tcp//netbios-ssn///, 389/open/tcp//ldap///, 445/open/tcp//microsoft-ds///, 636/open/tcp//ldapssl///, 3268/open/tcp//globalcatLDAP///, 3269/open/tcp//globalcatLDAPssl///, 5985/open/tcp//wsman///, 49154/open/tcp//unknown///, 49155/open/tcp//unknown///, 49157/open/tcp//unknown///, 49158/open/tcp//unknown///, 49170/open/tcp//unknown///
```

Services and Versions running:
```bash
nmap -p53,88,135,139,389,445,636,3268,3269,5985,49154,49155,49157,49158,49170 -sCV -Pn -n -vvvv -oN targeted 10.10.10.182
Nmap scan report for 10.10.10.182
Host is up, received user-set (0.18s latency).
Scanned at 2023-05-08 20:56:41 CST for 101s

PORT      STATE SERVICE       REASON  VERSION
53/tcp    open  domain        syn-ack Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
| dns-nsid: 
|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
88/tcp    open  tcpwrapped    syn-ack
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack
636/tcp   open  tcpwrapped    syn-ack
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49154/tcp open  msrpc         syn-ack Microsoft Windows RPC
49155/tcp open  msrpc         syn-ack Microsoft Windows RPC
49157/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
49158/tcp open  msrpc         syn-ack Microsoft Windows RPC
49170/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
```

Initial reconnaissance for UDP ports 
```bash
extractUDPPorts allUDPPorts

[*] Extracting information...

        [*] IP Address: 10.10.10.182
        [*] Open ports: 53,123,389
```

Services and Versions running:
```bash
nmap -p53,123,389 -sUCV -Pn -n -vvv -oN targetedUDP 10.10.10.182
Nmap scan report for 10.10.10.182
Host is up, received user-set (0.093s latency).
Scanned at 2023-05-08 21:01:38 CST for 10s

PORT    STATE SERVICE REASON               VERSION
53/udp  open  domain  udp-response ttl 127 Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
| dns-nsid: 
|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
123/udp open  ntp     udp-response ttl 127 NTP v3
| ntp-info: 
|_  receive time stamp: 2023-05-09T03:01:52
389/udp open  ldap    udp-response ttl 127 Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)
Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
```
We proceed to enumerate DNS protocol pointing to the domain retrieved on LDAP service name `cascade.local` with following commands:
```bash
dnsenum --dnsserver 10.10.10.182 --threads 50 -f /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt cascade.local
dnsenum VERSION:1.2.6

-----   cascade.local   -----                                                                                                                                                 
Host's addresses:                                                                                                                                                    
__________________                                                                                                                                                   
                                                                                                                                                                     
cascade.local.                           600      IN    A        10.10.10.182                                                                                        
cascade.local.                           600      IN    A        10.10.10.183

                                                                                                                                                                     
Name Servers:                                                                                                                                                        
______________                                                                                                                                                       
                                                                                                                                                                     
casc-dc1.cascade.local.                  3600     IN    A        10.10.10.182
``` 

Nothing useful other than a subdomain called `casc-dc1.cascade.local`.
Then we proceed to enumerate LDAP with the following command:
```bash
ldapsearch -x -H ldap://10.10.10.182 -b "dc=cascade,dc=local"
```

```bash
ldapsearch -x -H ldap://10.10.10.182 -b "DC=cascade,DC=local" | grep -A 20 -B 20 r.thompson 
whenCreated: 20200109193126.0Z
whenChanged: 20200323112031.0Z
displayName: Ryan Thompson
uSNCreated: 24610
memberOf: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local
uSNChanged: 295010
name: Ryan Thompson
objectGUID:: LfpD6qngUkupEy9bFXBBjA==
userAccountControl: 66048
badPwdCount: 14
codePage: 0
countryCode: 0
badPasswordTime: 133281155838077047
lastLogoff: 0
lastLogon: 132247339125713230
pwdLastSet: 132230718862636251
primaryGroupID: 513
objectSid:: AQUAAAAAAAUVAAAAMvuhxgsd8Uf1yHJFVQQAAA==
accountExpires: 9223372036854775807
logonCount: 2
sAMAccountName: r.thompson
sAMAccountType: 805306368
userPrincipalName: r.thompson@cascade.local
objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local
dSCorePropagationData: 20200126183918.0Z
dSCorePropagationData: 20200119174753.0Z
dSCorePropagationData: 20200119174719.0Z
dSCorePropagationData: 20200119174508.0Z
dSCorePropagationData: 16010101000000.0Z
lastLogonTimestamp: 132294360317419816
msDS-SupportedEncryptionTypes: 0
cascadeLegacyPwd: clk0bjVldmE=
```


### Exploitation


### Root privesc

### Post Exploitation

### Credentials
```bash
r.thompson@cascade.local:rY4n5eva
s.smith@cascade.local:sT333ve2
```

### Notes

-   Chisel have different configurations, this time we use a Forward SOCKS Proxy, which is a bind shell, that is not neccessarily the easiest way to forward the remote port, but is a new way to consider in case that a reverse shell is not possible.
-   Always look for exploits, analyze them and check if something can be useful to exploit the machine.
-   Chisel has some

### Resources:



